## Burstable AutoScaling Strategy (BurScale)

### 一. 简介

目前市场主流的自动扩展策略往往仅运用了常规的计算优化型和存储优化型实例，而各大云厂商相继在这些年推出了基于这些机器之上的可突增实例。 许多通用型工作负载通常不繁忙，并且不需要高水平的持续 CPU 性能。
这些低至中等 CPU 利用率工作负载会导致 CPU 周期浪费，因此，您需要支付的费用超过使用量。为了解决这个问题，您可以利用低成本可突增通用型实例，即 T 实例。
[详细信息](https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/burstable-performance-instances.html)

不同的可突增实例类型实例大小有其相对应的利用率基准线。

当实例的 CPU 利用率在基准线之下时，实例将积攒 CPU 积分。
利用率越低，积攒积分越快。但是每个实例可以积攒的积分也有一个上限，达到上限以后积分将不会继续增长。

而当实例的 CPU 利用率在基准线之上时，实例将消耗 CPU 积分。
利用率越高，消耗积分越快。当消耗完当前积分以后将会产生超额消耗积分。每个实例可超额消耗掉的积分也有一个上限，当超额消耗掉的积分达到实例每天能积累积分上限，或者当前实例被终止，AWS将会对您收取额外费用。
在达到上限之前，超额消耗的积分是可以通过后续积攒的积分所抵消掉的。

BurScale 则是专门为了利用可突增实例的特性而设计的自动扩展策略。它在普通的自动扩展策略的基础上，
将用户的每个集群分为常规组和可突增组，并通过利用动态的分配两组的流量，使得它比常见的扩展策略更加敏捷，更加省钱。


### 二. 如何工作

#### 常规目标组和可突增目标组： 
在 BurScale 的集群里，将会有两类实例，常规实例和可突增实例。两种类型的实例将会分配给对应的两个目标组。
在正常流量区间，BurScale 将会将大部分流量导至常规目标组，将可突增组的 CPU 利用率保持在基准线之下，慢慢积攒积分。

当异常流量出现的时候，BurScale 首先会放开对可突增目标组的流量的限制，使得集群立即得以百分百利用可突增实例来化解危机。紧接着，BurScale 将会开启新的实例，来继续应对后续的请求增长。


#### 计算集群大小：
* 请求处理率：实例每秒可以处理请求数量

* 请求率：实例每秒收到请求数

这里 BurScale 运用了Queuing Theory 以及 Shortest Stuff Rule，利用请求处理率和请求率算出来最少所需实例数，以及
理想所需实例数。其中理想所需实例数即是集群总大小，而最少所需实例数则是常规实例数量，中间的差即可以用可突增实例填补。

### 三. BurScale vs.目标扩展策略

- BurScale 通过监控请求数量，可以比其他被动策略更快的发现异常流量并对此作出反应。
- BurScale 通过动态依据请求处理率和请求率来计算实例数量，比其他策略有更精准的扩展动作，避免了因为CPU数据延迟而带来的影响。
- BurScale 通过用可突增实例替换一部分常规实例，并且加上对 CPU 积分的利用，使得同样集群大小下的花费更少。

### 四. 如何使用

1. 在创建 SpoTainer 组时点击"使用BurScale策略创建组"。

2. 在 BurScale 策略下, 填写以下选项：

![img](../_images/burscale/burscale_menu.png)

* 策略名称：您的策略名称
* 目标组：BurScale SpoTainer 组所用的已关联负载均衡器的目标组
* 允许 Stompy 重新创建所选 ALB 和目标组*：我们将参照您所选的负载均衡器，复制一个同样的均衡器并将 SpoTainer 组下的两个目标组连接于这个新建均衡器，不影响您原有的负载均衡器和目标组的运行
* SLO 延迟时间：特定目标组的最大响应时间
* 可突增系列：BurScale 所使用的突增实例类型（具体大小将会与常规实例所对应）
* 常规实例类型：BurScale 所使用的常规实例类型
* 策略偏好： 您的自定义策略偏好（高可用将产生更高的花销，请谨慎选择）


*注：若不勾选，Stompy 将创建可突增实例目标组，注册到并且**接管**所关联的负载均衡器。若该 SpoTainer 组被删除，所选的目标组与负载均衡器也不会被 Stompy 自动删除。
   
3. 保存和应用配置，点击下一步，并点击创建。 
